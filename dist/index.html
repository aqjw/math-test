<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <!-- версия для разработки, отображает полезные предупреждения в консоли -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Math</title>
    <style>
        #app {
            background: #efefef;
            width: 100vw;
            height: 100vh;
        }
        .btn-custom {
            width: 100%;
            height: 60px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div style="width: 300px;" class="mx-auto">
            <div class="form-group">
                <div class="row pt-3">
                    <div class="col-5 text-center"><b>{{ num1 }}</b></div>
                    <div class="col-2 text-center"><b>{{ '+' }}</b></div>
                    <div class="col-5 text-center"><b>{{ num2 }}</b></div>
                </div>
            </div>
            <div class="form-group">
                <input type="number" pattern="\d*" inputmode="numeric"
                    class="form-control" v-model="prediction" ref="prediction" v-on:keyup.enter="check">
            </div>
            <div class="form-group text-center">
                <div v-if="null !== result_state" :class="[result_state ? 'text-success' : 'text-danger']">
                    {{ result_state ? 'верно' : 'неверно' }}
                </div>
            </div>    
        </div>

    </div>

    <script>
        var app = new Vue({
            el: '#app',
            data: {
                result_state: null,
                prediction: 0,
                num1: 0,
                num2: 0,

                user: {
                    level: 0,
                    stats: {
                        correct: 0,
                        incorrect: 0,
                    },
                },

                levels: [
                    {total: 20},
                    {total: 40},
                    {total: 60},
                    {total: 80},
                    {total: 100},
                ],
            },
            watch: {
                prediction(newValue) {
                    if (newValue > 1) {
                        setTimeout(() => {
                            this.check(newValue)
                        }, 400)
                    }
                }
            },
            mounted() {
                this.generate()
            },
            methods: {
                generate() {
                    this.num1 = Math.ceil(Math.random()*(10*(this.user.level+1)))
                    this.num2 = Math.ceil(Math.random()*(10*(this.user.level+1)))
                },
                check(prediction) {
                    real = this.num1 + this.num2
                    if (real == prediction) {
                        this.generate()
                        this.$refs.prediction.focus()
                        this.prediction = null
                        this.result_state = 1
                        this.user.stats.correct++
                        if (this.user.stats.correct > this.user.stats.incorrect &&
                            this.user.stats.correct > this.levels[this.user.level].total) {
                            this.user.level++
                        }
                    } else {
                        this.user.stats.incorrect++
                        this.result_state = 0
                    }
                    setTimeout(() => {
                        this.result_state = null
                    }, 1000)
                }
            }
        })
    </script>
</body>
</html>